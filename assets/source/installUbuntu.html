<?php
// 問題データ
$questions = array(
    'ubuntu_question_1' => 'sudo',
    'ubuntu_question_2' => '/etc',
    'ubuntu_question_3' => 'update',
    'ubuntu_question_4' => 'upgrade',
    'ubuntu_question_5' => 'ufw'
);
?>

    <!-- ハンバーガーメニュー -->
    <button id="hamburger" class="hamburger" aria-label="メニューを開く">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- オーバーレイ -->
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <div class="container">
        <!-- サイドバー（目次） -->
        <nav class="sidebar">
            <h3>目次</h3>
            <ul class="toc">
<li><a href="#1">Ubuntuのインストール</a>
<ul>
<li><a href="#1.1">ブートローダーの起動</a></li>
<li><a href="#1.2">言語の選択</a></li>
<li><a href="#1.3">キーボードレイアウトの設定</a></li>
<li><a href="#1.4">アップデートと他のソフトウェア</a></li>
<li><a href="#1.5">インストールの種類</a></li>
<li><a href="#1.6">どこに住んでいますか</a></li>
<li><a href="#1.7">あなたの情報を入力してください</a></li>
<li><a href="#1.8">インストールの開始</a></li>
</ul>
</li>
<li><a href="#2">基本設定</a>
<ul>
<li><a href="#2.1">ログイン</a></li>
<li><a href="#2.2">初期セットアップウィンドウ</a></li>
<li><a href="#2.3">端末の起動</a></li>
<li><a href="#2.4">root パスワードの設定</a></li>
<li><a href="#2.5">rootユーザにログイン</a></li>
<li><a href="#2.6">ネットワークの設定</a></li>
<li><a href="#2.7">NTPの設定</a></li>
<li><a href="#2.8">各ツール別のプロキシ設定</a></li>
</ul>
</li>
<li><a href="#3">メールサーバの構築</a>
<ul>
<li><a href="#3.1">Postfix</a></li>
<li><a href="#3.2">ファイアウォールの設定</a></li>
<li><a href="#3.3">クライアントからの動作確認</a></li>
<li><a href="#3.4">Dovecot（POP3）</a></li>
<li><a href="#3.5">ファイアウォールの設定</a></li>
<li><a href="#3.6">クライアントからの動作確認</a></li>
</ul>
</li>
<li><a href="#4">WEBサーバの構築</a>
<ul>
<li><a href="#4.1">Apache2のインストール</a></li>
<li><a href="#4.2">Apache2の設定</a></li>
<li><a href="#4.3">コンテンツの設置</a></li>
<li><a href="#4.4">サーバでの動作確認</a></li>
<li><a href="#4.5">ファイアウォールの設定</a></li>
<li><a href="#4.6">クライアントからの動作確認</a></li>
</ul>
</li>
</ul>
        </nav>

        <!-- メインコンテンツ -->
        <main class="main-content">
                <h1 id="1">Ubuntuのインストール</h1>
<p>UbuntuはLinuxディストリビューションの中でもサーバ向け、デスクトップ向け共に人気の高いディストリビューションです。これからUbuntuをコンピュータにインストールしてメールサーバ、ウェブサーバの機能を持ったサーバを構築していきます。</p>
<p>今回インストールするバージョンはUbuntu 22.04.2 - Desktopです。</p>

<h2 id="1.1">ブートローダーの起動</h2>
<p>黒い画面が現れたら<code>「Try or Install Ubuntu」</code>に矢印キーでカーソルを合わせて[Enter]</p>
<p>しばらくの時間、起動の準備が行われます。</p>

<h2 id="1.2">言語の選択</h2>
<p>使用する言語を選択します。デフォルトでは日本語に設定されています。</p>
<p>使用する言語に併せて、左のリストを下にスクロールして、言語を選択してください。</p>
<p>言語が選択出来たら<strong>[ Ubuntuをインストール ]</strong>を選択します。</p>

<h2 id="1.3">キーボードレイアウトの設定</h2>
<p>キーボードの配列を設定します。</p>
<p>デフォルトでは日本語配列になっています。</p>
<p>問題がなければ、<strong>[続ける]</strong>を選択します。</p>

<h2 id="1.4">アップデートと他のソフトウェア</h2>
<p><strong>[通常のインストール]</strong>を選択し、<strong>[続ける]</strong>を選択します。</p>

<h2 id="1.5">インストールの種類</h2>
<p><strong>[ディスクを削除してUbuntuをインストール]</strong>を選択し、<strong>[インストール]</strong>を選択します。</p>

<p><strong>[ディスクに変更を書き込みますか？]</strong>というウィンドウが出現します。問題がなければ、<strong>[続ける]</strong>を選択します。</p>

<h2 id="1.6">どこに住んでいますか</h2>
<p>時刻の設定をします。  </p>
<p>世界地図で日本にピンが刺されてあり、下の入力欄に「Tokyo」とあったら[続ける]を選択します。</p>

<h2 id="1.7">あなたの情報を入力してください</h2>
<p>表示された項目を以下の表から設定してください。</p>
<table class="table-auto">
<thead>
<tr>
<th>項目</th>
<th>入力値</th>
</tr>
</thead>
<tbody>
<tr>
<td>あなたの名前</td>
<td>tome</td>
</tr>
<tr>
<td>コンピュータの名前</td>
<td><?php echo $serverHostname; ?></td>
</tr>
<tr>
<td>ユーザ名の入力</td>
<td>tome</td>
</tr>
<tr>
<td>パスワードの入力</td>
<td>netsys00</td>
</tr>
<tr>
<td>パスワードの確認</td>
<td>netsys00</td>
</tr>
</tbody>
</table>
<p>[ログイン時にパスワードを要求する]にチェックを付けて[続ける]を選択します。</p>

<h2 id="1.8">インストールの開始</h2>
<p>インストールの準備が完了すると、インストールが開始されます。</p>
<p>インストールにしばらくかかります。</p>

<p>インストールが完了すると[インストールが完了しました]というポップアップと共に、再起動を促されます。</p>

<p><strong>[今すぐ再起動する]</strong>を選択して再起動を行います。</p>

<div class="note">
<p><p><strong>注記:</strong></p></p>
<p><p>Ubuntuのロゴとロードマークが表示されながら「Please remove the installation medium, then press ENTER:(インストールメディアを取り出し、ENTER キーを押してください。)」と表示されます。指示通り、Enterを押すとマシンが完全に停止します。</p></p>
</div>

<p>SCTSのメニューより、「インストールサーバの起動」からUbuntuを選択して再び起動してください。</p>

<h1 id="2">基本設定</h1>

<h2 id="2.1">ログイン</h2>
<p>起動が完了すると、ログイン画面が表示されます。</p>

<p>中央のアイコン<code>tome</code>をクリックして、設定したパスワード<code>netsys00</code>を入力してEnterを押してログインします。</p>

<h2 id="2.2">初期セットアップウィンドウ</h2>
<p>初めてログインをすると、Livepathchセキュリティのセットアップが表示されます。</p>
<p>左の[次へ]をクリックして[完了]を押してください。</p>

<h2 id="2.3">端末の起動</h2>
<p>左下端の[アプリケーション]アイコンをクリックして項目の中から[端末]をクリックします。または[検索キーワード入力]から[Terminal]と入力して[端末]をクリックしします。</p>

<div class="hint">
<p><p><strong>ヒント:</strong></p></p>
<p><p><code>Ctrl+Alt+T</code>でもターミナルが開けます</p></p>
</div>

<h2 id="2.4">root パスワードの設定</h2>
<p>端末を開き、root のパスワードを設定します。</p>
<p>rootのパスワードは<code>netsys00</code>に設定します。</p>

<div class="question-box" id="ubuntu_question_1"><div class="question-content"><div class="question-header"><p class="question-text">一般ユーザが管理者権限でコマンドを実行するとき使用するコマンドは何ですか？</p><span class="success-message" id="ubuntu_question_1_success" style="display: none;">正解</span></div><div class="answer-input-container"><input type="text" id="ubuntu_question_1_input" class="answer-input" placeholder="****" data-question-id="ubuntu_question_1"><button type="button" class="submit-answer-btn" data-question-id="ubuntu_question_1">回答</button><button type="button" class="giveup-btn" id="ubuntu_question_1_giveup" data-question-id="ubuntu_question_1" style="display: none;">解答を見る</button></div></div></div>

<pre><code class="language-bash">tome@<?php echo $serverHostname; ?>:~$ sudo passwd root
tomeのパスワード:
新しいパスワード:
新しいパスワードを再入力してください:</code></pre>
<div class="caution">
<p><p><strong>注意:</strong></p></p>
<p><p>パスワードの入力中は文字が何も表示されません。</p>
<p>キーボードで入力したら、Enterを押してください。</p></p>
</div>

<h2 id="2.5">rootユーザにログイン</h2>
<p>現在はtomeにログインしていますが、今後、rootで作業するために、rootにログインを行います。</p>
<pre><code class="language-bash">tome@<?php echo $serverHostname; ?>:~# su -
パスワード:
root@<?php echo $serverHostname; ?>:~#</code></pre>
<p>root権限ではシェルの記号が<code>$</code>から<code>#</code>に表記が変わります。</p>
<p>root権限ではシステムの全ての権限を保持しているので、慎重に操作してください。</p>

<h2 id="2.6">ネットワークの設定</h2>
<p>nmtuiを起動してネットワークの設定を行います。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# nmtui</code></pre>

<p><code>接続の編集</code>-><code>編集</code>でネットワークの設定ファイルの編集を行います。</p>
<div class="hint">
<p><p><strong>ヒント:</strong></p></p>
<p><p>TUI(Terminal User Interface)での操作は主に<code>Tabキー</code>,<code>矢印キー</code>,<code>Enterキー</code>で操作します。</p></p>
</div>

<p><strong>IPv4の設定</strong>の<code><strong>自動</strong></code>を[Enter]して<code><strong>手作業</strong></code>に変更します。</p>
<p>右の<code><strong><表示する></strong></code>にカーソルを合わせて[Enter]を押します。</p>

<p>次の項目に以下を記入します。</p>
<table class="table-fixed">
<thead>
<tr>
<th>項目名</th>
<th>入力値</th>
</tr>
</thead>
<tbody>
<tr>
<td>アドレス</td>
<td><?php echo $serverIP; ?></td>
</tr>
<tr>
<td>ゲートウェイ</td>
<td><?php echo $gatewayIP; ?></td>
</tr>
<tr>
<td>DNSサーバー</td>
<td><?php echo $gatewayIP; ?></td>
</tr>
<tr>
<td>検索ドメイン</td>
<td>netsys.cs.t-kougei.ac.jp</td>
</tr>
<tr>
<td>検索ドメイン</td>
<td>cs.t-kougei.ac.jp</td>
</tr>
<tr>
<td>検索ドメイン</td>
<td>t-kougei.ac.jp</td>
</tr>
</tbody>
</table>

<p>次に<strong>IPv6の設定</strong>の<code><strong>自動</strong></code>を[Enter]して<code><strong>無効</strong></code>に変更します。</p>

<p>すべての設定が終わったら、一番下の<code><strong><ＯＫ></strong></code>を選択して、[Enter]を押します。</p>
<p><code><strong><戻る></strong></code>を押して、一番最初に戻ります。</p>

<h3 id="2.6.1">ホスト名の設定</h3>
<p><code>nmtui</code>の一番最初のオプション選択メニューから<code>システムのホスト名を設定する</code>を選択します。</p>
<p>ホスト名を<code><?php echo $serverHostname; ?></code>を<code><?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp</code>に変更して<code><strong><ＯＫ></strong></code>を[Enter]します。</p>

<p>「ホスト名を'<?php echo $serverHostname; ?>.cs.t-kougei.a.cjp'に設定します」と表示されたら完了です。<code><strong><ＯＫ></strong></code>を[Enter]します。</p>

<p>すべての設定が完了したら一番最初のオプション選択メニューの最後にあ<code><strong><ＯＫ></strong></code>を[Enter]します。</p>

<h3 id="2.6.2">ネットワークの設定の確認</h3>
<p><code>ip</code>コマンドを使用して正しくネットワークに接続できているか確認します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
…
2: enp1s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:62:e8:57 brd ff:ff:ff:ff:ff:ff
    inet <?php echo $serverIP; ?>/24 brd 10.10.1.255 scope global noprefixroute enp1s0
       valid_lft forever preferred_lft forever</code></pre>

<p>ネットワークデバイス、<code>enp1s0</code>の<code>inet</code>が<code><?php echo $serverIP; ?>/24</code>とあれば正しく設定されています。</p>
<p>また、enp1s0にipv6の項目がなければ、ipv6を無効に設定できています。</p>

<h3 id="2.6.3">ホスト名の設定の確認</h3>
<div class="question-box" id="ubuntu_question_2"><div class="question-content"><div class="question-header"><p class="question-text">プログラムの設定ファイルが格納されているディレクトリはどこでしょうか(絶対パスで入力)</p><span class="success-message" id="ubuntu_question_2_success" style="display: none;">正解</span></div><div class="answer-input-container"><input type="text" id="ubuntu_question_2_input" class="answer-input" placeholder="****" data-question-id="ubuntu_question_2"><button type="button" class="submit-answer-btn" data-question-id="ubuntu_question_2">回答</button><button type="button" class="giveup-btn" id="ubuntu_question_2_giveup" data-question-id="ubuntu_question_2" style="display: none;">解答を見る</button></div></div></div>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# cat /etc/hostname</code></pre>
<p>これでホスト名が正しく表示されたら設定は完了です。</p>

<h2 id="2.7">NTPの設定</h2>
<p>デフォルトではヨーロッパのNTPサーバに接続されているため、学内に設置された<code>ntp-a.t-kougei.ac.jp</code>に接続するように設定します。</p>

<h3 id="2.7.4">設定ファイルディレクトリの作成</h3>
<p>NTPプロトコルはSystemdが管理しています。<code>timesyncd.conf.d</code>を作成するとで、設定ファイルを設置できるようにします。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# mkdir -p /etc/systemd/timesyncd.conf.d/</code></pre>

<h3 id="2.7.5">設定ファイルの作成</h3>
<p>viで新たにNTPの設定ファイル<code>ntp-kougei.conf</code>を作成します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# vi /etc/systemd/timesyncd.conf.d/ntp-kougei.conf</code></pre>

<div class="code-file-info">📁 /etc/systemd/timesyncd.conf.d/ntp-kougei.conf</div>
<pre><code>[Time]
NTP=ntp-a.t-kougei.ac.jp</code></pre>

<h3 id="2.7.6">systemd-timesyncdの再起動</h3>
<p><code>systemdctl</code>コマンドで<code>systemd-timesyncd</code>を再起動します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# systemctl restart systemd-timesyncd</code></pre>

<h3 id="2.7.7">NTPの接続確認</h3>
<p><code>timedatectl</code>コマンドで大学のNTPサーバに接続しているか確認します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# timedatectl timesync-status
       Server: 192.168.16.188 (ntp-a.t-kougei.ac.jp)
Poll interval: 1min 4s (min: 32s; max 34min 8s)
         Leap: normal
      Version: 4
      Stratum: 2
    Reference: 96640107
    Precision: 1us (-26)
Root distance: 2.700ms (max: 5s)
       Offset: +26.200ms
        Delay: 336us
       Jitter: 0
 Packet count: 1
    Frequency: +191.938ppm</code></pre>
<p>[Server]の項目行に<code>ntp-a.t-kougei.ac.jp</code>が記述されていれば完了です。</p>


<h2 id="2.8">各ツール別のプロキシ設定</h2>

<h3 id="2.8.8">NetworkMangaerのプロキシ設定</h3>
<p>右上の電源アイコンをクリックして、表示された項目欄から[設定]を選択します。</p>
<p>ネットワークの設定項目のうち<code>ネットワークプロキシ</code>をの歯車マークをクリックします。</p>
<p><strong>無効</strong>から<strong>手動</strong>に変更して、以下の項目を入力します。</p>
<table class="table-fixed">
<thead>
<tr>
<th>項目名</th>
<th>入力値</th>
<th>ポート</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTPプロキシ</td>
<td>proxy-a.t-kougei.ac.jp</td>
<td>8080</td>
</tr>
<tr>
<td>HTTPSプロキシ</td>
<td>proxy-a.t-kougei.ac.jp</td>
<td>8080</td>
</tr>
<tr>
<td>FTPプロキシ</td>
<td>proxy-a.t-kougei.ac.jp</td>
<td>8080</td>
</tr>
<tr>
<td>Socksホスト</td>
<td>proxy-a.t-kougei.ac.jp</td>
<td>8080</td>
</tr>
<tr>
<td>次のホストを無視する</td>
<td>*.t-kougei.ac.jp</td>
<td>-</td>
</tr>
</tbody>
</table>

<p>入力が完了したら×で閉じます。</p>
<p>設定ウィンドウも×で閉じます。</p>

<h3 id="2.8.9">Bashのプロキシ設定</h3>
<p>再び端末に戻って設定を行います。  </p>
<p>新たに<code>/etc/profile.d/proxy.sh</code>ファイルを作成してプロキシ設定を記述します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# vi /etc/profile.d/proxy.sh</code></pre>

<div class="hint">
<p><p><strong>ヒント:</strong></p></p>
<p><p>viエディタは通常モードで「h」で左に移動、「j」で下に移動、「k」で上に移動、「l」で右に移動。  </p>
<p>「i」で入力モードに切り替える。「Esc」を押して通常モードに戻る。</p>
<p>通常モードで「:w」で保存「:q」で終了、「:wq」で保存して終了。</p></p>
</div>  

<div class="code-file-info">📁 /etc/profile.d/proxy.sh</div>
<pre><code>HTTP_PROXY=http://proxy-a.t-kougei.ac.jp:8080
HTTPS_PROXY=http://proxy-a.t-kougei.ac.jp:8080

http_proxy=http://proxy-a.t-kougei.ac.jp:8080
https_proxy=http://proxy-a.t-kougei.ac.jp:8080</code></pre>

<p><code>source</code>コマンドで作成した設定ファイルを読み込ませます。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# source /etc/profile.d/proxy.sh</code></pre>
<h3 id="2.8.10">aptのプロキシ設定</h3>
<p><code>/etc/apt/apt.conf.d</code>の配下に<code>30proxy.conf</code>ファイルを新たに作成します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# vi /etc/apt/apt.conf.d/30proxy.conf</code></pre>

<p>ファイルに以下を記述します。</p>

<div class="code-file-info">📁 /etc/apt/apt.conf.d/30proxy.conf</div>
<pre><code>Acquire::http::Proxy "http://proxy-a.t-kougei.ac.jp:8080";
Acquire::https::Proxy "http://proxy-a.t-kougei.ac.jp:8080";</code></pre>

<h3 id="2.8.11">パッケージの更新とインストール</h3>
<div class="question-box" id="ubuntu_question_3"><div class="question-content"><div class="question-header"><p class="question-text">aptコマンドでアップデート可能なパッケージの情報を更新をするサブコマンドは何でしょうか</p><span class="success-message" id="ubuntu_question_3_success" style="display: none;">正解</span></div><div class="answer-input-container"><input type="text" id="ubuntu_question_3_input" class="answer-input" placeholder="******" data-question-id="ubuntu_question_3"><button type="button" class="submit-answer-btn" data-question-id="ubuntu_question_3">回答</button><button type="button" class="giveup-btn" id="ubuntu_question_3_giveup" data-question-id="ubuntu_question_3" style="display: none;">解答を見る</button></div></div></div>
<p>以下のコマンでアップデート可能なパッケージ情報を更新します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# apt update</code></pre>
<p>先頭にステータスが表示されます。<strong>取得</strong>と表示されていれば</p>
<p>既存のリポジトリからパッケージの更新がされていることを意味します。</p>
<p><strong>取得</strong>の文字が確認できたら成功です。</p>

<div class="note">
<p><p><strong>注記:</strong></p></p>
<p><p>パッケージの更新後に、「ソフトウェアの更新」というポップアップがされる時があります。<strong>「後で通知する」</strong>を選択して、消しましょう。</p></p>
</div>

<p>パッケージのアップグレードをします。</p>
<div class="question-box" id="ubuntu_question_4"><div class="question-content"><div class="question-header"><p class="question-text">aptコマンドでパッケージを更新するサブコマンドは何でしょうか</p><span class="success-message" id="ubuntu_question_4_success" style="display: none;">正解</span></div><div class="answer-input-container"><input type="text" id="ubuntu_question_4_input" class="answer-input" placeholder="*******" data-question-id="ubuntu_question_4"><button type="button" class="submit-answer-btn" data-question-id="ubuntu_question_4">回答</button><button type="button" class="giveup-btn" id="ubuntu_question_4_giveup" data-question-id="ubuntu_question_4" style="display: none;">解答を見る</button></div></div></div>
<p>以下のコマンで、パッケージを更新します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# apt upgrade -y</code></pre>
<div class="note">
<p><p><strong>注記:</strong></p></p>
<p><p>アップグレードには時間がかかるので気長に待ちましょう</p></p>
</div>

<h1 id="3">メールサーバの構築</h1>

<p>メールサーバはメールの送受信を行うためのサーバです。  </p>
<p>メールの送信には<strong>Postfix</strong>が、受信には<strong>Davcot</strong>が使用されます。  </p>

<h2 id="3.1">Postfix</h2>
<p>Postfixは、オープンソースのメール転送エージェント(MTA: Mail Transfer Agent)で、電子メールの送信・配送を担当するサーバソフトウェアです。</p>

<h3 id="3.1.12">Postfix のインストール</h3>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# apt install -y postfix</code></pre>

<p>インストール中に[パッケージの設定]が表示されます。</p>
<p>完了を押し、<strong>[インターネットサイト]</strong>を選択し、設定してたホスト名が記述されているか確認して<strong><了解></strong>を選択します。</p>

<h3 id="3.1.13">postfixの設定</h3>
<p>postfixの設定ファイルである<code>/etc/postfix/main.cf</code>を<code>vi</code>エディタで編集します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# vi /etc/postfix/main.cf</code></pre>

<p>以下の設定を行います。</p>

<div class="code-file-info">📁 /etc/postfix/main.cf</div>
<pre><code>relayhost = <span class="git-add">[smtp-a.t-kougei.ac.jp</span>]
<span class="git-remove">mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128</span>
<span class="git-add">#mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128</span>
mynetworks = 10.10.0.0/16
<span class="git-remove">#inet_protocols = all</span>
<span class="git-add">inet_protocols = ipv4</span>
<span class="git-add">home_mailbox = Maildir/</span></code></pre>

<h3 id="3.1.14">postfixの設定の反映</h3>
<p><code>systemctl</code>コマンドでpostfixを再起動します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# systemctl restart postfix.service</code></pre>

<h2 id="3.2">ファイアウォールの設定</h2>
<div class="question-box" id="ubuntu_question_5"><div class="question-content"><div class="question-header"><p class="question-text">Ubuntuで簡単にファイアウォールを設定するコマンドは何でしょうか</p><span class="success-message" id="ubuntu_question_5_success" style="display: none;">正解</span></div><div class="answer-input-container"><input type="text" id="ubuntu_question_5_input" class="answer-input" placeholder="***" data-question-id="ubuntu_question_5"><button type="button" class="submit-answer-btn" data-question-id="ubuntu_question_5">回答</button><button type="button" class="giveup-btn" id="ubuntu_question_5_giveup" data-question-id="ubuntu_question_5" style="display: none;">解答を見る</button></div></div></div>
<p><code>ufw</code>コマンドでファイアウォールを設定します。</p>

<h3 id="3.2.15">ufwの有効化</h3>
<p>はじめに、ufwをアクティブに変更します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ufw enable
ファイアウォールはアクティブかつシステムの起動時に有効化されます。</code></pre>

<p>ufwがアクティブな状態になっているか確認します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ufw status
状態: アクティブ</code></pre>
<p>状態がアクティブであれば完了です。</p>

<h3 id="3.2.16">許可するサービスの追加</h3>
<p>外部からの接続を許可するサービスを指定します。今回追加するサービスはsmtpとpop3です。以下のようにして許可をします。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ufw allow smtp
ルールを追加しました
ルールを追加しました(v6)</code></pre>

<h3 id="3.2.17">ファイアウォールの設定項目の確認</h3>
<p><code>status</code>オプションで現在のファイアウォールの設定を確認します。</p>
<p>項目Toの<code>25</code>のAction項目が<code>ALLOW</code>であり、なおかつFromの項目が<code>Anywhere</code>であれば成功です。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ufw status
状態: アクティブ

To                         Action      From
--                         ------      ----
25/tcp                     ALLOW       Anywhere                  
25/tcp (v6)                ALLOW       Anywhere (v6)</code></pre>

<h2 id="3.3">クライアントからの動作確認</h2>

<h3 id="3.3.18">クライアントの起動とログイン</h3>

<p>クライアントを起動して<code>mail</code>コマンドをインストールしてメールの送信テストをします。</p>

<p>SSCTSメニューから、<strong>[仮想コンピュータの操作]</strong>をクリック。<strong>[Client]</strong>の<strong>[制御]</strong>をクリックし、<strong>[起動]</strong>をクリックしてクライアントを起動します。</p>

<p>ユーザ名は<code>root</code>。パスワードは<code>netsys00</code>でログインします。</p>

<h3 id="3.3.19">クライアントのrelayhostを指定。</h3>
<p>クライアントのPostfixのメール配送先を構築したサーバに変更します。</p>
<pre><code class="language-bash">root@<?php echo $clientHostname; ?>:~# vi /etc/postfix/main.cf</code></pre>

<p>main.cfにある既存の<code>relayhost</code>ディレクティブを全てコメントアウトし、新しく構築したサーバを追加します。</p>

<div class="code-file-info">📁 /etc/postfix/main.cf</div>
<pre><code>#relayhost = [smtp-a.t-kougei.ac.jp]
relayhost = [<?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp]</code></pre>

<h3 id="3.3.20">mailコマンドでtomeに送信</h3>
<p>ターミナルを起動して、<code>mail</code>コマンドでtomeに「test」というメッセージを送ります。  </p>
<pre><code class="language-bash">root@<?php echo $clientHostname; ?>:~# echo "test" | mail tome@<?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp</code></pre>

<p>サーバの<code>/home/tome/Maildi/new</code>ディレクトリに新しくファイルが作成されており、ファイルの内容が「test」とあれば、成功です。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ls /home/tome/Maildir/new/</code></pre>

<h3 id="3.3.21">外部ネットワークへのメール送信確認</h3>
<p>サーバ外にメールが届くかテストを行います。</p>
<p>クライアントから自分の大学用のメールアドレスにメールを送信してメールが届くか確認します。</p>
<pre><code class="language-bash">root@<?php echo $clientHostname; ?>:~# echo "test" | mail <学籍番号>@st.t-kougei.ac.jp</code></pre>

<p>自分の大学用のメールボックスにrootから「test」というメッセージが来ていたら成功です。</p>

<div class="note">
<p><p><strong>注記:</strong></p></p>
<p><p>もしも以下のコマンドを実行した結果、パラメータの値が表と合致していたらメールが届いてなくても成功です。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# 
grep "st.t-kougei.ac.jp" /var/log/mail.log | tail -1 | egrep 'to=|relay=|status="</code></pre>

<table class="table-auto">
<thead>
<tr>
<th>パラメータ</th>
<th>値</th>
</tr>
</thead>
<tbody>
<tr>
<td>to</td>
<td>大学用のメールアドレス</td>
</tr>
<tr>
<td>relay</td>
<td>smtp-a.t-kougei.ac.jp</td>
</tr>
<tr>
<td>status</td>
<td>sent</td>
</tr>
</tbody>
</table>
<p></p></p>
</div>


<h2 id="3.4">Dovecot（POP3）</h2>
<p>Dovecotは、IMAPおよびPOP3の両方のプロトコルに対応したオープンソースのメール受信サーバです。</p>

<h3 id="3.4.22">Dovecotのインストール</h3>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# apt install -y dovecot-core dovecot-pop3d</code></pre>

<h3 id="3.4.23">Dovecotの設定</h3>
<p>Dovcotの設定ファイルである<code>/etc/dovecot/conf.d/10-ssl.conf</code>ファイルをviエディタで開きます。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# vi /etc/dovecot/conf.d/10-ssl.conf</code></pre>

<p>SSLを無効にします。</p>
<p><code>ssl = no</code>をコメントアウトし、<code>ssl = yes</code>を追記します。</p>
<pre><code><span class="git-remove">ssl = no</span>
<span class="git-add">#ssl = no</span>
<span class="git-add">ssl = yes</span></code></pre>
<p>Dovcotの設定ファイルである<code>/etc/dovecot/conf.d/10-auth.conf</code>ファイルをviエディタで開きます。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# vi /etc/dovecot/conf.d/10-auth.conf</code></pre>

<p>コメントアウトを外してプレーンテキスト認証を許可します。</p>

<pre><code>#disable_plaintext_auth = yes
<span class="git-add">disable_plaintext_auth = no</span></code></pre>

<p>Dovcotの設定ファイルである<code>/etc/dovecot/conf.d/10-mail.conf</code>ファイルをviエディタで開きます。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# vi /etc/dovecot/conf.d/10-mail.conf</code></pre>

<p><code>mail_location</code> を <code>maildir:~/Maildir</code> に変更します。</p>

<pre><code><span class="git-remove">mail_locatoin = mbox:~/mail:IBBOX=/var/mail/%u</span>
<span class="git-add">#mail_locatoin = mbox:~/mail:IBBOX=/var/mail/%u</span>
<span class="git-add">mail_location = maildir:~/Maildir</span></code></pre>

<h3 id="3.4.24">Dovecotの設定の反映</h3>
<p><code>systemctl</code>コマンドでdovecotを再起動します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# systemctl restart dovecot</code></pre>

<h2 id="3.5">ファイアウォールの設定</h2>
<p><code>ufw</code>コマンドでファイアウォールを設定します。</p>

<h3 id="3.5.25">許可するサービスの追加</h3>
<p>外部からの接続を許可するサービスを指定します。今回追加するサービスはpop3です。以下のようにして許可をします。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ufw allow pop3
ルールを追加しました
ルールを追加しました(v6)</code></pre>

<h3 id="3.5.26">ファイアウォールの設定項目の確認</h3>
<p><code>status</code>オプションで現在のファイアウォールの設定を確認します。</p>
<p>項目Toの<code>110</code>のAction項目が<code>ALLOW</code>であり、なおかつFromの項目が<code>Anywhere</code>であれば成功です。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ufw status
状態: アクティブ

To                         Action      From
--                         ------      ----
25/tcp                     ALLOW       Anywhere                  
110/tcp                    ALLOW       Anywhere                  
25/tcp (v6)                ALLOW       Anywhere (v6)             
110/tcp (v6)               ALLOW       Anywhere (v6)</code></pre>

<h2 id="3.6">クライアントからの動作確認</h2>
<p><?php echo $clientHostname; ?>を起動して、Clientから<code>telnet</code>コマンドを使用してメールの受信を確認します。</p>

<pre><code class="language-bash">root@client1:~$ telnet <?php echo $serverHostname; ?> 110
Trying <?php echo $serverIP; ?>...
Connected to <?php echo $serverHostname; ?>.
Escape character is '^]'.
<span class="git-add">+OK Dovecto (Ubuntu) ready.</span></code></pre>
<p><code>+OK Dovecto (Ubuntu) ready.</code>という情報から、Dovecotに接続できたことが確認できました。</p>


<h3 id="3.6.27">メールの内容を確認する</h3>
<p>telnetでDovecotコマンドを入力します。</p>
<p>始めに、<code>USER</code>と<code>PASS</code>を指定してログインを行います。</p>
<pre><code>USER tome
+OK
PASS netsys00
+OK Logged in.</code></pre>
<p><code>+OK Logged in.</code>が表示されればログインされます。</p>

<pre><code class="language-bash">list
+OK 1 message:
1 516</code></pre>

<p><code>+OK 1 message:</code>というメッセージから1件のメールがあることが確認できます。</p>
<p><code>1 516</code>はメール番号とメールのサイズをバイトで表しています。</p>

<pre><code class="language-bash">retr 1
+OK 516 octets
Return-Path: root@<?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp
X-Original-TO: tome
<略></code></pre>

<div class="hint">
<p><p><strong>ヒント:</strong></p></p>
<p><p>telnetから抜けるには<code>quit</code>を入力して抜ける。</p>
<pre><code class="language-bash">…
+OK Dovecto (Ubuntu) ready.
quit
221 2.0.0 Bye
Connection closed by foreign host.</code></pre>
</div>

<p>送信したメールが表示されればメールサーバの構築は完了です。</p>

<h1 id="4">WEBサーバの構築</h1>

<h2 id="4.1">Apache2のインストール</h2>

<p><code>apt</code>コマンドでapache2をインストールします。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# apt install -y apache2</code></pre>

<h2 id="4.2">Apache2の設定</h2>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# vi /etc/apache2/sites-available/000-default.conf</code></pre>

<p>サーバの名前を記載します。</p>
<p>コメントアウトされている<code>ServerName</code>ディレクティブの下にコメントアウトを外した内容を<code><?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp</code>を追記します。</p>

<div class="code-file-info">📁 /etc/apache2/sites-available/000-default.conf</div>
<pre><code>#ServerName www.example.com
<span class="git-add">ServerName <?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp</span></code></pre>

<h2 id="4.3">コンテンツの設置</h2>
<p>サーバが提供するコンテンツを<code>/var/www/html/</code>に設置します。既に<code>index.html</code>は存在しているので、内容を削除して新たに内容を書きます。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# vi /var/www/html/index.html</code></pre>

<div class="hint">
<p><p><strong>ヒント:</strong></p></p>
<p><p>viでは<code>:%d</code>で文字の全削除することができる。</p></p>
</div>

<div class="code-file-info">📁 /var/www/html/index.html</div>
<pre><code>hello world</code></pre>

<h2 id="4.4">サーバでの動作確認</h2>
<p>実際にhello worldが表示されるか確認します。</p>

<p>左下のアプリケーションをクリックして検索バーから<code>Firefox</code>と入力して提示されたアプリケーションを起動します。</p>

<p>ナビゲーションバーに<a href="http://<?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp">http://<?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp</a>を入力してアクセスします。</p>

<p>真っ白な背景にhello worldと表示されていればサーバからの確認は成功です。</p>

<h2 id="4.5">ファイアウォールの設定</h2>
<p><code>ufw</code>コマンドでファイアウォールを設定します。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ufw allow http</code></pre>
<div class="note">
<p><p><strong>注記:</strong></p></p>
<p><p>もしPostfixでufwをアクティブにしていない場合、以下のコマンドでアクティブにします。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ufw enable</code></pre>
</div>

<h3 id="4.5.28">ファイアウォールの設定項目の確認</h3>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~# ufw status
状態: アクティブ

To                         Action      From
--                         ------      ----
25/tcp                     ALLOW       Anywhere                  
110/tcp                    ALLOW       Anywhere                  
80/tcp                     ALLOW       Anywhere                  
25/tcp (v6)                ALLOW       Anywhere (v6)             
110/tcp (v6)               ALLOW       Anywhere (v6) 
80/tcp (v6)                ALLOW       Anywhere (v6)</code></pre>

<p><code>80/tcp</code>が追加されていればファイアウォールの設定は完了です。</p>

<h2 id="4.6">クライアントからの動作確認</h2>
<p><?php echo $clientHostname; ?>を起動して、WEBサーバにアクセスできるか確認します。  </p>

<p><?php echo $clientHostname; ?>を起動したらFirefoxから<a href="http://<?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp">http://<?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp</a>にアクセスしてます。</p>

<p>サーバでの確認と同様に真っ白な背景にhello worldと表示されていればクライアントからの確認は成功です。</p>

        </main>
    </div>

        <script>
            // 問題データをグローバル変数に設定
            window.questionsData = [{"id":"ubuntu_question_1","question":"一般ユーザが管理者権限でコマンドを実行するとき使用するコマンドは何ですか？","answer":"sudo"},{"id":"ubuntu_question_2","question":"プログラムの設定ファイルが格納されているディレクトリはどこでしょうか(絶対パスで入力)","answer":"/etc"},{"id":"ubuntu_question_3","question":"aptコマンドでアップデート可能なパッケージの情報を更新をするサブコマンドは何でしょうか","answer":"update"},{"id":"ubuntu_question_4","question":"aptコマンドでパッケージを更新するサブコマンドは何でしょうか","answer":"upgrade"},{"id":"ubuntu_question_5","question":"Ubuntuで簡単にファイアウォールを設定するコマンドは何でしょうか","answer":"ufw"}];
        </script>
        <script src="assets/js/spoiler-manager.js"></script>
        <script src="assets/js/timer-manager.js"></script>
        <script src="assets/js/api-manager.js"></script>
        <script src="assets/js/state-manager.js"></script>
        <script src="assets/js/questions.js"></script>
        