<!-- ハンバーガーメニュー -->
        <button id="hamburger" class="hamburger" aria-label="メニューを開く">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <!-- オーバーレイ -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>

        <div class="container">
            <!-- サイドバー（目次） -->
            <nav class="sidebar">
                <h3>目次</h3>
                <ul class="toc">
<li><a href="#1">RockyLinuxについて</a>
<ul>
<li><a href="#1.1">序章</a></li>
</ul>
</li>
<li><a href="#2">RockyLinuxのインストール</a>
<ul>
<li><a href="#2.1">言語選択</a></li>
<li><a href="#2.2">インストール先</a></li>
<li><a href="#2.3">Kdump</a></li>
<li><a href="#2.4">ネットワーク設定</a></li>
<li><a href="#2.5">時刻と日付の設定</a></li>
<li><a href="#2.6">追加ソフトウェアの選択</a></li>
<li><a href="#2.7">rootパスワードの設定</a></li>
<li><a href="#2.8">ユーザーの作成</a></li>
<li><a href="#2.9">インストールの開始</a></li>
</ul>
</li>
<li><a href="#3">基本設定</a>
<ul>
<li><a href="#3.1">ログイン</a></li>
<li><a href="#3.2">端末の起動</a></li>
<li><a href="#3.3">SELinuxの無効化</a></li>
<li><a href="#3.4">各ツール別のプロキシ設定</a></li>
</ul>
</li>
<li><a href="#4">メールサーバの構築</a>
<ul>
<li><a href="#4.1">Postfix</a></li>
<li><a href="#4.2">Dovecot（POP3）</a></li>
<li><a href="#4.3">client1からの動作確認</a></li>
</ul>
</li>
<li><a href="#5">WEBサーバの構築</a>
<ul>
<li><a href="#5.1">httpdのインストール</a></li>
<li><a href="#5.2">httpdの設定</a></li>
<li><a href="#5.3">コンテンツの設置</a></li>
<li><a href="#5.4">httpdの起動</a></li>
<li><a href="#5.5">クライアントからのチェック</a></li>
</ul>
</li>
<li><a href="#6">Firewallの設定</a></li>
<li><a href="#7">リモートアクセスの設定</a>
<ul>
<li><a href="#7.1">rloginとrshの設定</a></li>
<li><a href="#7.2">sshの設定</a></li>
</ul>
</li>
</ul>
            </nav>

            <!-- メインコンテンツ -->
            <main class="main-content">
                <h1 id="1">RockyLinuxについて</h1>

<p>RockyLinuxは、Red Hat EnterpriseLinux(RHEL)のダウンストリーム版であるCentOSの開発が中止され、CentOS創設者であるGregory Kurtzer氏がプロジェクトを立ち上げたLinuxディストリビューションです。開発はRockyLinux Projectで行われており、2021年から正式なリリースが行われています。</p>

<h2 id="1.1">序章</h2>

<p>OSのインストール練習として、RockyLinuxのインストールを行います。</p>

<h1 id="2">RockyLinuxのインストール</h1>

<h2 id="2.1">言語選択</h2>
<p>インストールが開始されると言語選択メニューが表示されます。左のメニューの中央付近にある[日本語]を選択し、[続行]を選択します。</p>

<h2 id="2.2">インストール先</h2>
<p>システムのインストール先を決定します。</p>
<p>[インストール先]を選択すると自動でインストール先が決定されるので、左上の青いボタンの[完了]をクリックします。</p>

<div class="note">
<p><strong>注記:</strong></p>
<p>システムの[インストール先]のアイコンに注意が表示されていたのが消えていればＯＫです。</p>
</div>

<h2 id="2.3">Kdump</h2>
<p>Kdumpの無効化を行うために、[KDUMP]を選択し、[kdumpを有効にする]のチェックボックスを外し、[完了]を選択します。</p>

<h2 id="2.4">ネットワーク設定</h2>
<p>次に、ネットワークの設定を行います。[ネットワークとホスト名]を選択し、ホスト名に<code><?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp</code>を入力します。</p>

<p>ホスト名入力後、[適用]をクリックします。</p>
<div class="caution">
<p><strong>注意:</strong></p>
<p>[適用]をクリックしないと設定が反映されないため注意してください。</p>
</div>

<p>さらに、[設定]を選択し、[IPv4の設定]をクリックし、方式を<strong>自動(DHCP)</strong>から<strong>手動</strong>に変更します。</p>

<p>アドレスの[追加]を選択し、以下の項目に値を入力していきます。</p>

<table class="table-fixed">
<thead>
<tr>
<th>項目名</th>
<th>入力値</th>
</tr>
</thead>
<tbody>
<tr>
<td>アドレス</td>
<td><?php echo $serverIP; ?></td>
</tr>
<tr>
<td>ネットマスク</td>
<td>24</td>
</tr>
<tr>
<td>ゲートウェイ</td>
<td><?php echo $gatewayIP; ?></td>
</tr>
<tr>
<td>DNSサーバー</td>
<td><?php echo $serverIP; ?></td>
</tr>
<tr>
<td>ドメインを検索</td>
<td>netsys.cs.t-kougei.ac.jp, cs.t-kougei.ac.jp, t-kougei.ac.jp</td>
</tr>
</tbody>
</table>

<p>入力が完了したら[保存]を押して閉じます。</p>

<p>入力後、右上のトグルボタンをクリックして有効に切り替えます。</p>

<p>Ethernetが「接続済みです」と表示されていればネットワークの接続は完了です。</p>

<p>左上の[完了]を押します。</p>

<h2 id="2.5">時刻と日付の設定</h2>
<p>地域設定から[時刻と日付]を選択します。</p>
<p>左上の歯車マークをクリックして[使用するNTPサーバの追加]に<code>ntp-a.t-kougei.ac.jp</code>を入力して[＋]ボタンを押します。</p>

<p><code>ntp-a.t-kougei.ac.jp</code>の稼働中の項目欄にチェックがあれば完了です。</p>

<p>OKで閉じて、左上の[完了]ボタンを押します。</p>

<h2 id="2.6">追加ソフトウェアの選択</h2>
<p>インストールするソフトウェアの選択を行います。[ソフトウェアの選択]を選択し、ベース環境は[サーバー(GUI使用)]を選択します。</p>
<p>選択した環境用のその他のソフトウェアは以下を選択します。</p>
<ul>
<li>メールサーバー</li>
<li>ベーシックWebサーバー</li>
</ul>
<p>選択が完了したら、左上の[完了]をクリックします。</p>

<h2 id="2.7">rootパスワードの設定</h2>
<p>[ユーザーの設定]の[rootパスワード]をクリックします。</p>

<p>rootのパスワードには、[netsys00]を入力し、同じく確認でも同じパスワードを入力してください。</p>

<p>入力が完了したら左上の[完了]をクリックします。</p>

<p>:::cation</p>
<p>［このパスワードは辞書チェックに失敗しました］と表示されますが、この場合完了を2回クリックします。</p>
<p>:::</p>

<h2 id="2.8">ユーザーの作成</h2>
<p>ユーザーtomeを作成します。</p>

<table class="table-auto">
<thead>
<tr>
<th>項目名</th>
<th>入力値</th>
</tr>
</thead>
<tbody>
<tr>
<td>ユーザネーム</td>
<td>tome</td>
</tr>
<tr>
<td>ユーザー名</td>
<td>tome</td>
</tr>
<tr>
<td>パスワード</td>
<td>netsys00</td>
</tr>
<tr>
<td>パスワードの確認</td>
<td>netsys00</td>
</tr>
</tbody>
</table>

<p>:::cation</p>
<p>rootのパスワードと同様に［このパスワードは辞書チェックに失敗しました］と表示されますが、この場合完了を2回クリックします。</p>
<p>:::</p>

<h2 id="2.9">インストールの開始</h2>
<p>全ての設定項目が完了したら、[インストールの開始]を選択します。</p>
<div class="note">
<p><strong>注記:</strong></p>
<p>インストールには時間がかかるため、終わるまで待機してください。</p>
</div>

<p>インストールが完了したら、[システムの再起動]を選択して、サーバを再起動します。</p>
<p>サーバが停止したら、SCTSメニューより、[インストールサーバの起動]->[RockyLinux]でサーバを起動します。</p>

<h1 id="3">基本設定</h1>

<h2 id="3.1">ログイン</h2>
<p>ライセンスに同意後、ログイン画面が表示されるため、ログインを行います。rootでログインを行うため、[アカウントが見つかりませんか？]を選択しrootでログインします。</p>

<table class="table-auto">
<thead>
<tr>
<th>項目名</th>
<th>入力値</th>
</tr>
</thead>
<tbody>
<tr>
<td>ユーザネーム</td>
<td>root</td>
</tr>
<tr>
<td>パスワード</td>
<td>netsys00</td>
</tr>
</tbody>
</table>

<h2 id="3.2">端末の起動</h2>
<p>左上の[アクティビティ]をクリック、または<Win>キーを押します。</p>
<p>中央下に表示されているアイコンにカーソルを合わせるとアプリケーション名が表示されるので、そこから[端末]を探します。もしくは、<win>キーを押した後に、[Terminal]と検索して提示された[端末]というソフトを起動します。</p>

<h2 id="3.3">SELinuxの無効化</h2>
<p>SELinuxの無効化を行います。</p>

<div class="warning">
<p><strong>警告:</strong></p>
<p>この設定にミスがあるとコンピュータが起動しなくなる可能性があるため注意してください。</p>
</div>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/selinux/config</code></pre>

<p>以下を変更:</p>
<pre><code><span class="git-remove">SELINUX=enforcing</span>
<span class="git-add">#SELINUX=enforcing</span>
<span class="git-add">SELINUX=disabled</span></code></pre>

<div class="hint">
<p><strong>ヒント:</strong></p>
<p>viエディタは通常モードで「h」で左に移動、「j」で下に移動、「k」で上に移動、「l」で右に移動。  </p>
<p>「i」で入力モードに切り替える。「Esc」を押して通常モードに戻る。</p>
<p>通常モードで「:w」で保存「:q」で終了、「:wq」で保存して終了。</p>

<p>また、通常モードで<code>/<探したい文字></code>で文字検索ができる。検索を辞める時は<strong><Esc></strong>キーを押す。</p></p>
<p></div>  </p>

<h2 id="3.4">各ツール別のプロキシ設定</h2>

<h3 id="3.4.1">NetworkMangaerのプロキシ設定</h3>
<p>右上の電源アイコンをクリックして[設定]を選択します。</p>
<p>設定画面が起動したら、項目ネットワークの中から</p>
<p><strong>ネットワークプロキシ</strong>を見つけ、[歯車マーク]をクリックします。  </p>
<p>[無効]から[手動]を変更し、次の項目に以下の入力値を入力していきます。</p>

<table class="table-fixed">
<thead>
<tr>
<th>項目名</th>
<th>入力値</th>
<th>ポート</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTPプロキシ</td>
<td>proxy-a.t-kougei.ac.jp</td>
<td>8080</td>
</tr>
<tr>
<td>HTTPSプロキシ</td>
<td>proxy-a.t-kougei.ac.jp</td>
<td>8080</td>
</tr>
<tr>
<td>FTPプロキシ</td>
<td>proxy-a.t-kougei.ac.jp</td>
<td>8080</td>
</tr>
<tr>
<td>Socksホスト</td>
<td>proxy-a.t-kougei.ac.jp</td>
<td>8080</td>
</tr>
<tr>
<td>次のホストを無視する</td>
<td>*.t-kougei.ac.jp</td>
<td>-</td>
</tr>
</tbody>
</table>

<p>入力が完了したら×で閉じます。</p>
<p>設定メニューも×で閉じます。</p>


<h3 id="3.4.2">bashのプロキシ設定</h3>
<p>再び端末に戻って設定を行います。  </p>
<p>新たに<code>/etc/profile.d/proxy.sh</code>ファイルを作成してプロキシ設定を記述します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/profile.d/proxy.sh</code></pre>

<p><div class="hint"></p>
<p><p><strong>ヒント:</strong></p></p>
<p><p>viエディタは通常モードで「h」で左に移動、「j」で下に移動、「k」で上に移動、「l」で右に移動。  </p>
<p>「i」で入力モードに切り替える。「Esc」を押して通常モードに戻る。</p>
<p>通常モードで「:w」で保存「:q」で終了、「:wq」で保存して終了。</p></p>
<p></div>  </p>

<pre><code>HTTP_PROXY=http://proxy-a.t-kougei.ac.jp:8080
HTTPS_PROXY=http://proxy-a.t-kougei.ac.jp:8080

http_proxy=http://proxy-a.t-kougei.ac.jp:8080
https_proxy=http://proxy-a.t-kougei.ac.jp:8080</code></pre>

<p>sourceコマンドで作成した設定ファイルを読み込ませます。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ source /etc/profile.d/proxy.sh</code></pre>

<h3 id="3.4.3">yumのプロキシ設定</h3>
<p>パッケージマネージャーyumの設定を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/yum.conf</code></pre>

<p><code>skip_if_unavailable=False</code>の下に以下を記入します。</p>

<pre><code>proxy=http://proxy-a.t-kougei.ac.jp:8080
timeout=900</code></pre>

<p>保存して終了後アップデートを行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ yum -y update --nobest</code></pre>

<h1 id="4">メールサーバの構築</h1>

<h2 id="4.1">Postfix</h2>

<p><div class="note"></p>
<p><p><strong>注記:</strong></p></p>
<p><p>OSのインストールで既にPostfixをインストールしていますが、チェック項目を忘れていた場合は以下のコマンドでインストールしてください。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ yum -y install postfix</code></pre>
<p></div></p>

<h3 id="4.1.4">Postfixの設定</h3>

<p>postfixの設定ファイルである<code>/etc/postfix/main.cf</code>を<code>vi</code>エディタで編集します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/postfix/main.cf</code></pre>

<p>以下の設定を行います。</p>

<div class="code-file-info">📁 /etc/postfix/main.cf</div>
<pre><code>myhostname = <?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp
mydomain = netsys.cs.t-kougei.ac.jp
myorigin = $mydomain
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
relayhost = [smtp-a.t-kougei.ac.jp]
mynetworks = 127.0.0.0/8
inet_interfaces = all
#inet_interfaces = localhost <- 先頭に#を挿入してコメントアウト
inet_protocols = ipv4
home_mailbox = Maildir/</code></pre>

<p><div class="note"></p>
<p><p><strong>注記:</strong></p></p>
<p><p><code>myorigin</code>: 外行きメールに使うドメイン</p>
<p><code>mydestination</code>: 受信するドメイン</p>
<p><code>mynetworks</code>: メールリレーを許可するネットワーク</p>
</div>

<h3 id="4.1.5">postfixの設定の反映</h3>
<p><code>systemctl</code>コマンドでpostfixを再起動します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl restart postfix.service</code></pre>

<h3 id="4.1.6">メール転送の設定</h3>
<p><code>/etc/aliases</code>ファイルに、 <code>転送元: 転送先</code> を指定することでメールを自動的に転送することができます。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/aliases</code></pre>

<p><code>/etc/aliases</code>ファイルに下記を記述します。</p>
<pre><code>root: kitamura@st.t-kougei.ac.jp</code></pre>

<p><code>newaliases</code>コマンドで、<code>/etc/aliases</code>ファイルの設定を反映させます。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ newaliases</code></pre>

<h3 id="4.1.7">メール送受信確認（ローカル）</h3>

<p>mailコマンドをインストールしてメールの送信テストをします。</p>

<h4 id="4.1.8">mailコマンドのインストール</h4>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ yum -y install s-nail</code></pre>

<h4 id="4.1.9">mailコマンドでtomeに送信</h4>
<p><code>mail</code>コマンドでtomeに「test」というメッセージを送ります。  </p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ echo "test" | mail tome</code></pre>

<p><code>/home/tome/Maildi/new</code>ディレクトリに新しくファイルが作成されており、ファイルの内容が「test」とあれば、成功です。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ cat /home/tome/Maildir/new</code></pre>

<h2 id="4.2">Dovecot（POP3）</h2>
<p>Dovecotは、IMAPおよびPOP3の両方のプロトコルに対応したオープンソースのメール受信サーバです。</p>

<h3 id="4.2.10">Dovecotのインストール</h3>
<p>既にインストール済みですが、もしインストールされていない場合は以下のコマンドでインストールしてください。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ yum -y install dovecot-core dovecot-pop3d</code></pre>

<h3 id="4.2.11">Dovecotの設定</h3>
<p>Dovcotの設定ファイルである<code>/etc/dovecot/dovecot.conf</code>ファイルをviエディタで開きます。</p>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/dovecot/dovecot.conf</code></pre>

<p>protocolsをpop3のみにします。  </p>

<div class="code-file-info">📁 /etc/dovecot/dovecot.conf</div>
<pre><code>protocols = pop3</code></pre>

<p>Dovcotの設定ファイルである<code>/etc/dovecot/conf.d/10-ssl.conf</code>ファイルをviエディタで開きます。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/dovecot/conf.d/10-ssl.conf</code></pre>

<p>SSLを無効にします。</p>

<pre><code>ssl = no</code></pre>
<p>Dovcotの設定ファイルである<code>/etc/dovecot/conf.d/10-auth.conf</code>ファイルをviエディタで開きます。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/dovecot/conf.d/10-auth.conf</code></pre>

<p>プレーンテキスト認証を許可します。</p>

<pre><code>disable_plaintext_auth = no</code></pre>

<p>Dovcotの設定ファイルである<code>/etc/dovecot/conf.d/10-mail.conf</code>ファイルをviエディタで開きます。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/dovecot/conf.d/10-mail.conf</code></pre>

<p><code>mail_location</code> を <code>maildir</code> に変更します。</p>

<pre><code>mail_location = maildir:~/Maildir</code></pre>

<h3 id="4.2.12">Dovecotの設定の反映</h3>
<p><code>systemctl</code>コマンドでdovecotを再起動します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl restart dovecot</code></pre>

<p><strong>Firewallの設定が必要</strong></p>

<h2 id="4.3">client1からの動作確認</h2>
<p>cilent1を起動して、client1から</p>
<p><code>telnet</code>コマンドを使用してメールの受信を確認します。</p>


<pre><code class="language-bash">tome@client1:~$ telnet <?php echo $serverHostname; ?> 110
user tome
pass netsys00
list
retr 1
dele 1
quit</code></pre>

<h1 id="5">WEBサーバの構築</h1>

<h2 id="5.1">httpdのインストール</h2>

<p>既にインストール済みですが、もしも未インストールの場合は以下のコマンドでインストールしてください。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ yum -y install httpd</code></pre>

<h2 id="5.2">httpdの設定</h2>
<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/httpd/conf/httpd.conf</code></pre>

<p>サーバの名前とポート番号を記載します。</p>

<div class="code-file-info">📁 /etc/httpd/conf/httpd.conf</div>
<pre><code>ServerName <?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp:80</code></pre>

<h2 id="5.3">コンテンツの設置</h2>
<p>サーバが提供するコンテンツを<code>/var/www/html/</code>に設置します。ファイル名は<code>index.html</code>とします。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /var/www/html/index.html</code></pre>

<div class="code-file-info">📁 /var/www/html/index.html</div>
<pre><code>hello world</code></pre>

<h2 id="5.4">httpdの起動</h2>

<p><code>systemctl</code>コマンドでhttpdの自動起動とサービスの開始をします。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl enable httpd</code></pre>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl start httpd</code></pre>

<h2 id="5.5">クライアントからのチェック</h2>

<p>クライアントからfirefoxを起動して、以下のURLにアクセスします。</p>
<p><a href="http://<?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp">http://<?php echo $serverHostname; ?>.netsys.cs.t-kougei.ac.jp</a></p>

<p>真っ白なページに「hello world」とあれば完了です。</p>


<h3 id="5.5.13">Firewallの設定</h3>
<p>client1から接続ができるようにFirewallの設定を行います。</p>


<h1 id="6">Firewallの設定</h1>
<p>Firewallサービスが起動しているかの確認を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl status firewalld</code></pre>

<p>出力結果:</p>
<pre><code>● firewalld.service - firewalld - dynamic firewall daemon
Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendorpreset: enabled)
Active: active (running) since 水 2021-04-14 10:09:28 JST; 4h 52min ago
Docs: man:firewalld(1)</code></pre>

<p>Activeの項目がactive (running)となっている場合はサービスが起動しているため、OKです。</p>
<p>inactiveとなっている場合は起動していないため、以下のコマンドを実行します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl start firewalld</code></pre>

<p>再度確認を行い、activeとなっていればOKです。</p>

<p>Firewallの設定確認を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --list-all</code></pre>

<p>出力結果:</p>
<pre><code>public (active)
target: default
icmp-block-inversion: no
interfaces: ens3
sources:
services: dhcpv6-client ssh
ports:
protocols:
masquerade: no
forward-ports:
source-ports:
icmp-blocks:
rich rules:</code></pre>

<p>必要のないdhcpv6-clientとsshの削除を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --permanent --remove-service=dhcpv6-client</code></pre>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --permanent --remove-service=ssh</code></pre>

<p>出力結果:</p>
<pre><code>success</code></pre>

<p>設定の反映を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --reload</code></pre>

<p>出力結果:</p>
<pre><code>success</code></pre>

<p>再度確認を行い、servicesの項目に消えていればOKです。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --list-all</code></pre>

<p>出力結果:</p>
<pre><code>public (active)
target: default
icmp-block-inversion: no
interfaces: ens3
sources:
services:
ports:
protocols:
masquerade: no
forward-ports:
source-ports:
icmp-blocks:
rich rules:</code></pre>

<p>Firewallの特定のIPアドレスからのアクセス許可を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="127.0.0.1/32" accept"</code></pre>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="<?php echo $gatewayIP; ?>/32" accept"</code></pre>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --permanent --add-rich-rule="rule family="ipv4" source address="<?php echo $clientIP; ?>/32" accept"</code></pre>

<p>出力結果:</p>
<pre><code>success</code></pre>

<p>設定の反映を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --reload</code></pre>

<p>出力結果:</p>
<pre><code>success</code></pre>

<p>再度確認を行い、rich rules:の項目に追加したIPアドレスが表示されていればOKです。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ firewall-cmd --list-all</code></pre>

<p>出力結果:</p>
<pre><code>public (active)
target: default
icmp-block-inversion: no
interfaces: ens3
sources:
services:
ports:
protocols:
masquerade: no
forward-ports:
source-ports:
icmp-blocks:
rich rules:
rule family="ipv4" source address="127.0.0.1/32" accept
rule family="ipv4" source address="<?php echo $gatewayIP; ?>/32" accept
rule family="ipv4" source address="<?php echo $clientIP; ?>/32" accept</code></pre>

<h1 id="7">リモートアクセスの設定</h1>

<h2 id="7.1">rloginとrshの設定</h2>
<p>rloginとrshのインストールを行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ yum -y install rsh rsh-server</code></pre>

<p>インストール後、設定を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /usr/lib/systemd/system/rsh.socket</code></pre>

<p>以下を変更:</p>
<pre><code>ListenStream=514 → ListenStream=0.0.0.0:514に変更</code></pre>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /usr/lib/systemd/system/rlogin.socket</code></pre>

<p>以下を変更:</p>
<pre><code>ListenStream=513 → ListenStream=0.0.0.0:513に変更</code></pre>

<p>設定の反映を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl daemon-reload</code></pre>

<p>rloginとrshの起動と自動起動設定を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl start rsh</code></pre>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl start rlogin</code></pre>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl enable rsh</code></pre>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl enable rlogin</code></pre>

<p>パスワード無しでログインを許可します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /root/.rhosts</code></pre>

<p>以下を記入:</p>
<pre><code><?php echo $gatewayIP; ?> root
<?php echo $gatewayIP; ?> user1
<?php echo $clientIP; ?> root
<?php echo $clientIP; ?> check</code></pre>

<p>rootユーザでログインを可能にします。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/pam.d/rsh</code></pre>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/pam.d/rlogin</code></pre>

<p>以下を変更:</p>
<pre><code>#auth require pam_securetty.so ← 先頭の#を削除</code></pre>

<h2 id="7.2">sshの設定</h2>
<p>sshの設定を変更します。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ vi /etc/ssh/sshd_config</code></pre>

<p>以下を変更:</p>
<pre><code>#PermitRootLogin Yes → 先頭の#を削除し，PermitRootLogin Noに変更
#PermitEmptyPasswords No ← 先頭の#を削除する</code></pre>

<p>設定の反映を行います。</p>

<pre><code class="language-bash">root@<?php echo $serverHostname; ?>:~$ systemctl restart sshd</code></pre>

<p>以上でOSのインストールと設定は完了となります。</p>


            </main>
        </div>