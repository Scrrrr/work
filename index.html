<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ubuntuのインストール</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- サイドバー（目次） -->
        <nav class="sidebar">
            <h3>目次</h3>
            <ul class="toc">
                <li><a href="#1">Ubuntuのインストール</a>
                    <ul>
                        <li><a href="#1.1">インストールする前に</a></li>
                        <li><a href="#1.2">ブートローダーの起動</a></li>
                        <li><a href="#1.3">言語の選択</a></li>
                        <li><a href="#1.4">キーボードレイアウトの設定</a></li>
                        <li><a href="#1.5">アップデートと他のソフトウェア</a></li>
                        <li><a href="#1.6">インストールの種類</a></li>
                        <li><a href="#1.7">どこに住んでいますか</a></li>
                        <li><a href="#1.8">あなたの情報を入力してください</a></li>
                        <li><a href="#1.9">インストールの開始</a></li>
                    </ul>
                </li>
                <li><a href="#2">Ubuntuサーバの設定</a>
                    <ul>
                        <li><a href="#2.1">基本設定</a></li>
                        <li><a href="#2.2">root に関する設定</a></li>
                        <li><a href="#2.3">ネットワーク設定</a></li>
                        <li><a href="#2.4">便利ツールの追加</a></li>
                    </ul>
                </li>
                <li><a href="#3">NFS クライアント</a>
                    <ul>
                        <li><a href="#3.1">NFSのインストール</a></li>
                        <li><a href="#3.2">NFSマウントの例</a></li>
                    </ul>
                </li>
                <li><a href="#4">Mail サーバ</a>
                    <ul>
                        <li><a href="#4.1">Postfix</a></li>
                        <li><a href="#4.2">Dovecot（POP3）</a></li>
                    </ul>
                </li>
                <li><a href="#5">ファイアウォールの設定（UFW）</a></li>
                <li><a href="#6">ログインサーバ（SSH）</a>
                    <ul>
                        <li><a href="#6.1">telnet サーバ</a></li>
                        <li><a href="#6.2">rsh サーバ</a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- メインコンテンツ -->
        <main class="main-content">
            <h1 id="1">Ubuntuのインストール</h1>
            <p>UbuntuはLinuxディストリビューションの中でもサーバ向け、デスクトップ向け共に人気の高いディストリビューションです。これからUbuntuをコンピュータにインストールしてメール、ウェブ、ファイル共有、リモートログイン機能を持ったサーバを構築していきます。</p>
            <p>今回インストールするバージョンはUbuntu 22.04.2 - Desktopです。</p>

            <h2 id="1.1">インストールする前に</h2>
            <p>このマニュアルは設定内容と基本説明のみで構成されています。 そのため、コマンドの操作などは実際に調べて設定してもらいます。 コマンドの調べ方は「[コマンドの名前] 操作方法」または「[コマンドの名前] 使い方」で検索してブログ記事やオンラインマニュアルから探してください。</p>

            <h2 id="1.2">ブートローダーの起動</h2>
            <p>黒い画面が現れたら<code>「Try or Install Ubuntu」</code>に矢印キーでカーソルを合わせて[Enter]</p>
            <p>しばらくの時間、起動の準備が行われます。</p>

            <h2 id="1.3">言語の選択</h2>
            <p>使用する言語を選択します。デフォルトでは[英語]に設定されているので、左のリストを下にスクロールして、[日本語]を選択します。</p>
            <p>[Ubuntuをインストール]を選択します。</p>

            <h2 id="1.4">キーボードレイアウトの設定</h2>
            <p>キーボードの配列を設定します。</p>
            <p>デフォルトでは日本語配列になっています。</p>
            <p>問題がなければ、[続ける]を選択します。</p>

            <h2 id="1.5">アップデートと他のソフトウェア</h2>
            <p>[通常のインストール]を選択し、[続ける]を選択します。</p>

            <h2 id="1.6">インストールの種類</h2>
            <p>[ディスクを削除してUbuntuをインストール]を選択し、[インストール]を選択します。</p>
            <p>※警告が表示されますが、無視してください。</p>
            <p>[ディスクに変更を書き込みますか]と問われるので、[続ける]を選択します。</p>

            <h2 id="1.7">どこに住んでいますか</h2>
            <p>時刻の設定をします。</p>
            <p>世界地図で日本にピンが刺されてあり、下の入力欄に「Tokyo」とあったら[続ける]を選択します。</p>

            <h2 id="1.8">あなたの情報を入力してください</h2>
            <pre><code>あなたの名前：tome
コンピュータの名前：tr253
ユーザ名の入力：tome
パスワードの入力：netsys00
パスワードの確認：netsys00</code></pre>
            <p>[ログイン時にパスワードを要求する]で[続ける]</p>

            <h2 id="1.9">インストールの開始</h2>
            <p>全ての設定項目を終えると、インストールが開始されます。</p>
            <p>しばらくすると、再起動を促されます。</p>
            <p>再起動をすると、「Please remove the installation medium, then press ENTER:(インストールメディアを取り出し、ENTER キーを押してください。)」と表示されます。指示通り、Enterを押すとマシンが完全に停止します。</p>

            <h1 id="2">Ubuntuサーバの設定</h1>

            <h2 id="2.1">基本設定</h2>

            <h3>vi の設定</h3>
            <p><code>Ctrl+Alt+T</code>でターミナルを開きます。</p>
            <p>ホームディレクトリで <code>~/.vimrc</code> を作成して互換モードを無効化します。</p>
            <pre><code class="language-bash">tome@tr253:~$ vi ~/.vimrc</code></pre>
            <p>以下を追記します。</p>
            <pre><code>set nocompatible</code></pre>
            <div class="hint">
                <p><strong>ヒント:</strong></p>
                <p>viは「i」でインサートモード。「Esc」を押して通常モードに戻る。</p>
                <p>「:w」で保存「:q」で終了、「:wq」で保存して終了。</p>
            </div>

            <h3>省電力設定（デスクトップ環境）</h3>
            <p>右上のスピーカーアイコン → 設定 → 電源管理 から、以下を設定します。</p>
            <ul>
                <li>画面のブランク: しない</li>
            </ul>

            <h2 id="2.2">root に関する設定</h2>

            <h3>root パスワードの設定</h3>
            <p>端末を開き、root のパスワードを設定します。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo passwd root [Enter]
tomeのパスワード:
新しいパスワード:(tomeと同じ)
新しいパスワードを再入力してください:(tomeと同じ)</code></pre>
            <p>※パスワードの入力中は文字が何も表示されません。</p>

            <h3>PAMの設定</h3>
            <p>続いて <code>su</code>コマンドが使用できるユーザを制御します。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo vi /etc/pam.d/su</code></pre>
            <p>15行目付近にある以下のコメントを外し、末尾に <code>group=adm</code> を付けます。</p>
            <pre>auth required pam_wheel.so <code class="token-red">group=adm</code></pre>
            <div class="hint">
                <p><strong>ヒント:</strong></p>
                <p>vimは通常モードで</p>
                <p>「h」で左に移動、「j」で下に移動、「k」で上に移動、「l」で右に移動</p>
            </div>

            <h2 id="2.3">ネットワーク設定（root 権限で実施）</h2>

            <h3>IPアドレスの設定（nmtui）</h3>
            <p><code>nmtui</code>コマンドを用いてIPアドレスを手動で設定します。</p>
            <pre><code class="language-bash">sudo nmtui</code></pre>
            <ul>
                <li>接続の編集 → 対象インターフェースを選択 → 編集</li>
                <li>IPv4 の設定: 手作業</li>
                <li>アドレス: <code>10.10.0.253/24</code></li>
                <li>ゲートウェイ: <code>10.10.0.254</code></li>
                <li>DNS サーバー: <code>10.10.0.254</code></li>
                <li>検索ドメイン: <code>netsys.cs.t-kougei.ac.jp cs.t-kougei.ac.jp t-kougei.ac.jp</code></li>
            </ul>
            <p>設定後、OK → 戻る → 終了。</p>

            <h3>ホスト名の設定</h3>
            <p><code>hostnamectl</code>コマンドを使用してホスト名を変更します。</p>
            <pre><code class="language-bash">tome@tr253:~$ hostnamectl set-hostname tr253.netsys.cs.t-kougei.ac.jp [Enter]</code></pre>

            <h3>設定確認とネットワーク再起動</h3>
            <p>IPアドレスが適切にenp10のinetに割り当てられているか確認します。</p>
            <pre><code class="language-bash">tome@tr253:~$ ip a</code></pre>
            <p>もしも割り当てられていなかったらNetworkManagerを再起動します。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo systemctl restart NetworkManager</code></pre>

            <h3>APTのプロキシ設定</h3>
            <p>APTパッケージマネージャーが大学内のプロキシサーバを経由できるように設定を行います。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo vi /etc/apt/apt.conf</code></pre>
            <p>以下を設定します。</p>
            <pre><code class="language-bash">Acquire::http::Proxy "http://proxy-a.t-kougei.ac.jp:8080";
Acquire::https::Proxy "http://proxy-a.t-kougei.ac.jp:8080";</code></pre>

            <h2 id="2.4">便利ツールの追加</h2>
            <p>ネットワークの利用状況を確認する<code>netstat</code>コマンドなどを使用するために <code>net-tools</code> を導入します。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo apt -y install net-tools</code></pre>

            <h1 id="3">NFS クライアント</h1>
            <p>NFSはネットワーク上でファイルの送受信を行うためのプロトコルです。</p>
            <p>NFSクライアントはNFSサーバからファイルを取得するためのソフトです。</p>

            <h2 id="3.1">NFSのインストール</h2>
            <pre><code class="language-bash">tome@tr253:~$ sudo apt -y install nfs-common</code></pre>

            <h2 id="3.2">NFSマウントの例</h2>
            <p>初めにマウントポイントを作成します。</p>
            <p><code>mount</code>コマンドの<code>-t</code>オプションでnfsであることを明記します。</p>
            <p>使用後は<code>umount</code>コマンドでアンマウントを行います。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo mkdir -p /jpc1
tome@tr253:~$ sudo mount -t nfs 172.21.14.1:/home1/unix/install /jpc1
tome@tr253:~$ sudo umount /jpc1</code></pre>

            <h1 id="4">Mail サーバ</h1>
            <p>Mailサーバはメールの送受信を行うためのサーバです。</p>

            <h2 id="4.1">Postfix</h2>
            <p>メールの送信には<strong>Postfix</strong>が、受信には<strong>Davcot</strong>が使用されます。</p>

            <h3>Postfix のインストール</h3>
            <pre><code class="language-bash">tome@tr253:~$ sudo apt -y install postfix</code></pre>
            <p>インストーラで「インターネットサイト」を選択し、ホスト名を確認します。</p>

            <h3>postfixの設定</h3>
            <p>postfixの設定ファイルである<code>/etc/postfix/main.cf</code>を<code>vi</code>エディタで編集します。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo vi /etc/postfix/main.cf</code></pre>
            <p>以下の設定を行います。</p>
            <pre><code class="language-bash">myhostname = tr253.netsys.cs.t-kougei.ac.jp
mydomain = netsys.cs.t-kougei.ac.jp
myorigin = $mydomain
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
relayhost = [smtp-a.t-kougei.ac.jp]
mynetworks = 127.0.0.0/8
inet_interfaces = all
inet_protocols = ipv4
home_mailbox = Maildir/</code></pre>
            <p><strong>参考:</strong></p>
            <ul>
                <li><code>myorigin</code>: 外行きメールに使うドメイン</li>
                <li><code>mydestination</code>: 受信するドメイン</li>
                <li><code>mynetworks</code>: メールリレーを許可するネットワーク</li>
            </ul>

            <h3>postfixの設定の反映</h3>
            <p><code>systemctl</code>コマンドでpostfixを再起動します。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo systemctl restart postfix.service</code></pre>

            <h3>メール転送の設定</h3>
            <p><code>/etc/aliases</code>ファイルに、 <code>転送元: 転送先</code> を指定することでメールを自動的に転送することができます。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo vi /etc/aliases</code></pre>
            <p><code>/etc/aliases</code>ファイルに下記を記述します。</p>
            <pre><code>root: kitamura@st.t-kougei.ac.jp</code></pre>
            <p><code>newaliases</code>コマンドで、<code>/etc/aliases</code>ファイルの設定を反映させます。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo newaliases</code></pre>

            <h3>メール送受信確認（ローカル）</h3>
            <p>mailコマンドをインストールしてメールの送信テストをします。</p>

            <h4>mailコマンドのインストール</h4>
            <pre><code class="language-bash">tome@tr253:~$ sudo apt -y install mailutils</code></pre>

            <h4>mailコマンドでtomeに送信</h4>
            <p><code>mail</code>コマンドでtomeに「Test」というメッセージを送ります。</p>
            <pre><code class="language-bash">tome@tr253:~$ echo "test" | mail tome</code></pre>
            <p><code>/home/tome/Maildi/new</code>ディレクトリに新しくファイルが作成されており、ファイルの内容が「Test」とあれば、成功です。</p>
            <pre><code class="language-bash">tome@tr253:~$ ls /home/tome/Maildir/new</code></pre>

            <h4>SMTP レベルでの確認（任意）</h4>
            <p><code>telnet</code>コマンドでSMTPが起動しているか確認します。</p>
            <pre><code class="language-bash">tome@tr253:~$ telnet localhost 25
> quit</code></pre>

            <h2 id="4.2">Dovecot（POP3）</h2>
            <p>Dovecotは、IMAPおよびPOP3の両方のプロトコルに対応したオープンソースのメール受信サーバです。</p>

            <h3>Dovecotのインストール</h3>
            <pre><code class="language-bash">tome@tr253:~$ sudo apt -y install dovecot-core dovecot-pop3d</code></pre>

            <h3>Dovecotの設定</h3>
            <p>Dovcotの設定ファイルである<code>/etc/dovecot/conf.d/10-ssl.conf</code>ファイルをviエディタで開きます。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo vi /etc/dovecot/conf.d/10-ssl.conf</code></pre>
            <p>SSLを無効にします。</p>
            <pre><code>ssl = no</code></pre>
            <p>Dovcotの設定ファイルである<code>/etc/dovecot/conf.d/10-auth.conf</code>ファイルをviエディタで開きます。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo vi /etc/dovecot/conf.d/10-auth.conf</code></pre>
            <p>プレーンテキスト認証を許可します。</p>
            <pre>disable_plaintext_auth = no</code></pre>
            <p>Dovcotの設定ファイルである<code>/etc/dovecot/conf.d/10-mail.conf</code>ファイルをviエディタで開きます。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo vi /etc/dovecot/conf.d/10-mail.conf</code></pre>
            <p><code>mail_location</code> を <code>maildir</code> に変更します。</p>
            <pre><code># mail_location = mbox:~/mail:INBOX=/var/mail/%u
mail_location = maildir:~/Maildir</code></pre>

            <h3>Dovecotの設定の反映</h3>
            <p><code>systemctl</code>コマンドでdovecotを再起動します。</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo systemctl restart dovecot</code></pre>

            <h3>client1からの POP3 動作確認</h3>
            <p>cilent1を起動して、client1から<code>telnet</code>コマンドを使用してメールの受信を確認します。</p>
            <pre><code class="language-bash">tome@client1:~$ telnet tr253 110
user tome
pass netsys00
list
retr 1
dele 1
quit</code></pre>

            <h1 id="5">ファイアウォールの設定（UFW）</h1>
            <p>25 番ポート（IPv4）を許可:</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo ufw allow proto tcp to 0.0.0.0/0 port 25</code></pre>
            <p>特定のIPアドレスを許可:</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo ufw allow proto tcp from 10.10.0.1</code></pre>
            <p>状態確認とルール削除:</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo ufw status numbered
tome@tr253:~$ sudo ufw delete &lt;番号&gt;</code></pre>
            <p>有効化/無効化:</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo ufw enable
tome@tr253:~$ sudo ufw disable</code></pre>
            <p>起動/停止は <code>systemctl</code> でも制御可能です。</p>

            <h1 id="6">ログインサーバ（SSH）</h1>
            <p>SSHは離れたコンピュータをセキュアに遠隔操作することが出来ます。</p>

            <h2>インストールと起動確認</h2>
            <pre><code class="language-bash">tome@tr253:~$ sudo apt -y install openssh-server</code></pre>
            <pre><code class="language-bash">tome@tr253:~$ sudo systemctl status sshd</code></pre>

            <h2>rootログインの許可（必要な場合のみ）</h2>
            <pre><code class="language-bash">tome@tr253:~$ sudo vi /etc/ssh/sshd_config</code></pre>
            <p>以下を追加/変更します。</p>
            <pre><code>PermitRootLogin yes</code></pre>
            <p>反映:</p>
            <pre><code class="language-bash">tome@tr253:~$ sudo systemctl restart ssh</code></pre>
            <p>接続例:</p>
            <pre><code class="language-bash"># サーバからクライアントへ
tome@tr253:~$ ssh -l root 10.10.0.1
# クライアントからサーバへ
tome@tr253:~$ ssh -l root 10.10.0.253</code></pre>

            <h2 id="6.1">telnet サーバ</h2>
            <pre><code class="language-bash">tome@tr253:~$ sudo apt -y install telnetd
tome@tr253:~$ telnet tr253</code></pre>

            <h2 id="6.2">rsh サーバ</h2>
            <pre><code class="language-bash">tome@tr253:~$ sudo apt -y install rsh-client rsh-server</code></pre>
            <p>パスワードなし接続の例（検証用途）:</p>
            <pre><code class="language-bash"># サーバ側（tr253）
tome@tr253:~$ sudo vi /root/.rhosts</code></pre>
<p></p>以下を記入</p>
<pre><code>root 10.10.0.1</code></pre>
<pre><code class="language-bash"># クライアント側（client1）
tome@client1:~$ sudo sh -c 'echo "root 10.10.0.253" > /root/.rhosts'</code></pre>
<p></p>以下を記入</p>
<pre><code>root 10.10.0.253</code></pre>


            <h1>参考</h1>
            <p>（参考）suができるユーザの設定</p>
            <p>（参考）# usermod -aG adm ユーザ名</p>
        </main>
    </div>

    <!-- PAGE TOP ボタン -->
    <button id="pageTop" class="page-top" title="ページトップへ">↑</button>

    <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-bash.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
